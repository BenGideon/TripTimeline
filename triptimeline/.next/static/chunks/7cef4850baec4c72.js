(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,70267,(e,r,t)=>{r.exports=e.r(26656)},11069,e=>{"use strict";let r=(0,e.i(38335).createClient)();async function t(){let{data:{user:e}}=await r.auth.getUser();if(!e)return null;let{data:t,error:i}=await r.from("user_profiles").select("*").eq("id",e.id).single();return i?null:t}async function i(e){let{data:{user:t}}=await r.auth.getUser();if(!t)throw Error("User not authenticated");let{error:i}=await r.from("user_profiles").update(e).eq("id",t.id);if(i)throw Error(`Failed to update profile: ${i.message}`)}async function s(e){let{data:{user:t}}=await r.auth.getUser();if(!t)return[];let{data:i,error:s}=await r.from("user_profiles").select("*").or(`full_name.ilike.%${e}%,email.ilike.%${e}%,username.ilike.%${e}%`).neq("id",t.id).limit(10);return s?[]:i||[]}async function a(e){let{data:{user:t}}=await r.auth.getUser();if(!t)throw Error("User not authenticated");let{error:i}=await r.from("friends").insert({user_id:t.id,friend_id:e,status:"pending"});if(i){if("23505"===i.code||i.message?.includes("friends_user_id_friend_id_key")){let e=Error("FRIEND_REQUEST_ALREADY_EXISTS");throw e.code="FRIEND_REQUEST_ALREADY_EXISTS",e}throw Error(`Failed to send friend request: ${i.message}`)}}async function n(e){let{data:{user:t}}=await r.auth.getUser();if(!t)throw Error("User not authenticated");let{error:i}=await r.from("friends").update({status:"accepted"}).eq("id",e).eq("friend_id",t.id);if(i)throw Error(`Failed to accept friend request: ${i.message}`);let{data:s}=await r.from("friends").select("user_id, friend_id").eq("id",e).single();if(s){let{error:e}=await r.from("friends").insert({user_id:t.id,friend_id:s.user_id,status:"accepted"});e&&e.message.includes("duplicate")}}async function l(e){let{data:{user:t}}=await r.auth.getUser();if(!t)throw Error("User not authenticated");let{error:i}=await r.from("friends").delete().eq("id",e).eq("friend_id",t.id);if(i)throw Error(`Failed to decline friend request: ${i.message}`)}async function o(e){let{data:{user:t}}=await r.auth.getUser();if(!t)throw Error("User not authenticated");let{error:i}=await r.from("friends").delete().eq("user_id",t.id).eq("friend_id",e),{error:s}=await r.from("friends").delete().eq("user_id",e).eq("friend_id",t.id);if(i||s)throw Error("Failed to remove friend")}async function d(){let{data:{user:e}}=await r.auth.getUser();if(!e)return[];try{let{data:t,error:i}=await r.from("friends").select(`
        *,
        friend_profile:user_profiles!friends_friend_id_fkey(*)
      `).eq("user_id",e.id).eq("status","accepted");if(i)return i.message?.includes('relation "public.friends" does not exist')||i.message?.includes('relation "public.user_profiles" does not exist'),[];return t||[]}catch(e){return[]}}async function c(){let{data:{user:e}}=await r.auth.getUser();if(!e)return[];try{let{data:t,error:i}=await r.from("friends").select(`
        id,
        status,
        created_at,
        from_user:user_profiles!friends_user_id_fkey(*),
        to_user:user_profiles!friends_friend_id_fkey(*)
      `).eq("friend_id",e.id).eq("status","pending");if(i){if(i.message?.includes('relation "public.friends" does not exist'))throw Error("FRIENDS_TABLE_MISSING");return[]}return t||[]}catch(e){if("FRIENDS_TABLE_MISSING"===e.message)throw e;return[]}}async function u(e,t,i="viewer"){let{data:{user:s}}=await r.auth.getUser();if(!s)throw Error("User not authenticated");let{error:a}=await r.from("trip_collaborators").insert({trip_id:e,user_id:t,role:i,invited_by:s.id,status:"pending"});if(a){if("23505"===a.code||a.message?.includes("trip_collaborators_trip_id_user_id_key")){let e=Error("TRIP_COLLABORATOR_ALREADY_INVITED");throw e.code="TRIP_COLLABORATOR_ALREADY_INVITED",e}throw Error(`Failed to invite user to trip: ${a.message}`)}}async function f(e){let{data:{user:t}}=await r.auth.getUser();if(!t)throw Error("User not authenticated");let{data:i,error:s}=await r.from("trip_collaborators").update({status:"accepted"}).eq("id",e).eq("user_id",t.id);if(s)throw Error(`Failed to accept trip invitation: ${s.message}`)}async function m(e){let{data:{user:t}}=await r.auth.getUser();if(!t)throw Error("User not authenticated");let{error:i}=await r.from("trip_collaborators").update({status:"declined"}).eq("id",e).eq("user_id",t.id);if(i)throw Error(`Failed to decline trip invitation: ${i.message}`)}async function h(e,t){let{data:{user:i}}=await r.auth.getUser();if(!i)throw Error("User not authenticated");let{error:s}=await r.from("trip_collaborators").delete().eq("trip_id",e).eq("user_id",t);if(s)throw Error(`Failed to remove user from trip: ${s.message}`)}async function p(e){let{data:t,error:i}=await r.from("trip_collaborators").select(`
      *,
      user_profile:user_profiles!trip_collaborators_user_id_fkey(*),
      inviter_profile:user_profiles!trip_collaborators_invited_by_fkey(*)
    `).eq("trip_id",e).eq("status","accepted");return i?[]:t||[]}async function x(){let{data:{user:e}}=await r.auth.getUser();if(!e)return[];try{let{data:t,error:i}=await r.from("trip_collaborators").select(`
        id,
        role,
        status,
        created_at,
        trip:trips(id, title, destination, start_date, end_date)
      `).eq("user_id",e.id).eq("status","pending");if(i){if(i.message?.includes('relation "public.trip_collaborators" does not exist')||i.message?.includes('relation "public.user_profiles" does not exist'))throw Error("FRIENDS_TABLE_MISSING");return[]}return t||[]}catch(e){if("FRIENDS_TABLE_MISSING"===e.message)throw e;return[]}}async function g(e,t,i){let{data:{user:s}}=await r.auth.getUser();if(!s)throw Error("User not authenticated");let{error:a}=await r.from("trip_collaborators").update({role:i}).eq("trip_id",e).eq("user_id",t);if(a)throw Error(`Failed to update collaborator role: ${a.message}`)}async function b(e){let{data:{user:t}}=await r.auth.getUser();if(!t)return!1;let{data:i}=await r.from("trips").select("user_id").eq("id",e).single();if(i&&i.user_id===t.id)return!0;let{data:s}=await r.from("trip_collaborators").select("role").eq("trip_id",e).eq("user_id",t.id).eq("status","accepted").single();return s&&("editor"===s.role||"owner"===s.role)}e.s(["acceptFriendRequest",()=>n,"acceptTripInvitation",()=>f,"canEditTrip",()=>b,"declineFriendRequest",()=>l,"declineTripInvitation",()=>m,"getCurrentUserProfile",()=>t,"getFriendRequests",()=>c,"getFriends",()=>d,"getTripCollaborators",()=>p,"getTripInvitations",()=>x,"inviteToTrip",()=>u,"removeFriend",()=>o,"removeFromTrip",()=>h,"searchUsers",()=>s,"sendFriendRequest",()=>a,"updateCollaboratorRole",()=>g,"updateUserProfile",()=>i])},91494,e=>{"use strict";var r=e.i(21227),t=e.i(61013),i=e.i(84961),s=e.i(70267),a=e.i(11069);function n(){let{user:e,loading:n}=(0,i.useAuth)(),l=(0,s.useRouter)(),[o,d]=(0,t.useState)([]),[c,u]=(0,t.useState)([]),[f,m]=(0,t.useState)([]),[h,p]=(0,t.useState)(""),[x,g]=(0,t.useState)("friends"),[b,w]=(0,t.useState)(!0);(0,t.useEffect)(()=>{n||e||l.push("/auth/login")},[e,n,l]),(0,t.useEffect)(()=>{e&&_()},[e]);let _=async()=>{try{let[e,r]=await Promise.all([(0,a.getFriends)(),(0,a.getFriendRequests)()]);d(e),u(r)}catch(e){console.error("Error loading friends data:",e)}finally{w(!1)}},y=async e=>{if(p(e),e.trim().length>2)try{let r=await (0,a.searchUsers)(e);m(r)}catch(e){console.error("Error searching users:",e)}else m([])},v=async e=>{try{await (0,a.sendFriendRequest)(e),m(f.filter(r=>r.id!==e)),alert("Friend request sent!")}catch(e){console.error("Error sending friend request:",e),e?.code==="FRIEND_REQUEST_ALREADY_EXISTS"?alert("Friend request already sent. Wait for them to respond."):alert("Failed to send friend request")}},j=async e=>{try{await (0,a.acceptFriendRequest)(e),await _()}catch(e){console.error("Error accepting friend request:",e),alert("Failed to accept friend request")}},N=async e=>{try{await (0,a.declineFriendRequest)(e),u(c.filter(r=>r.id!==e))}catch(e){console.error("Error declining friend request:",e),alert("Failed to decline friend request")}},E=async e=>{if(window.confirm("Are you sure you want to remove this friend?"))try{await (0,a.removeFriend)(e),d(o.filter(r=>r.friend_id!==e))}catch(e){console.error("Error removing friend:",e),alert("Failed to remove friend")}};return n||b?(0,r.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 via-blue-50 to-indigo-100 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Loading friends..."})]})}):(0,r.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 via-blue-50 to-indigo-100",children:[(0,r.jsx)("div",{className:"bg-white/80 backdrop-blur-sm border-b border-white/20 sticky top-0 z-10",children:(0,r.jsx)("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,r.jsx)("div",{className:"flex items-center justify-between h-16",children:(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsx)("button",{onClick:()=>l.push("/dashboard"),className:"text-gray-600 hover:text-gray-900 transition-colors",children:"â† Back to Dashboard"}),(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Friends"})]})})})}),(0,r.jsxs)("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,r.jsxs)("div",{className:"flex space-x-1 bg-white/60 backdrop-blur-sm rounded-xl p-1 mb-8",children:[(0,r.jsxs)("button",{onClick:()=>g("friends"),className:`flex-1 py-2 px-4 rounded-lg font-medium transition-all ${"friends"===x?"bg-white text-purple-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:["Friends (",o.length,")"]}),(0,r.jsxs)("button",{onClick:()=>g("requests"),className:`flex-1 py-2 px-4 rounded-lg font-medium transition-all ${"requests"===x?"bg-white text-purple-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:["Requests (",c.length,")"]}),(0,r.jsx)("button",{onClick:()=>g("search"),className:`flex-1 py-2 px-4 rounded-lg font-medium transition-all ${"search"===x?"bg-white text-purple-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:"Add Friends"})]}),"friends"===x&&(0,r.jsx)("div",{className:"space-y-4",children:0===o.length?(0,r.jsxs)("div",{className:"text-center py-12 bg-white/60 backdrop-blur-sm rounded-2xl",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,r.jsx)("svg",{className:"w-8 h-8 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"})})}),(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No friends yet"}),(0,r.jsx)("p",{className:"text-gray-600 mb-4",children:"Start building your travel network!"}),(0,r.jsx)("button",{onClick:()=>g("search"),className:"bg-gradient-to-r from-purple-600 to-blue-600 text-white px-6 py-2 rounded-lg font-medium hover:from-purple-700 hover:to-blue-700 transition-all",children:"Add Friends"})]}):(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:o.map(e=>(0,r.jsx)("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-6 shadow-sm border border-white/20",children:(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-purple-400 to-blue-400 rounded-full flex items-center justify-center",children:(0,r.jsx)("span",{className:"text-white font-semibold text-lg",children:e.friend_profile?.full_name?.charAt(0)||e.friend_profile?.email?.charAt(0)||"?"})}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("h3",{className:"font-semibold text-gray-900",children:e.friend_profile?.full_name||"Unknown User"}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:e.friend_profile?.email})]}),(0,r.jsx)("button",{onClick:()=>E(e.friend_id),className:"text-red-500 hover:text-red-700 p-2 rounded-lg hover:bg-red-50 transition-colors",title:"Remove friend",children:(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})},e.id))})}),"requests"===x&&(0,r.jsx)("div",{className:"space-y-4",children:0===c.length?(0,r.jsxs)("div",{className:"text-center py-12 bg-white/60 backdrop-blur-sm rounded-2xl",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,r.jsx)("svg",{className:"w-8 h-8 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"})})}),(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No pending requests"}),(0,r.jsx)("p",{className:"text-gray-600",children:"You're all caught up!"})]}):(0,r.jsx)("div",{className:"space-y-4",children:c.map(e=>(0,r.jsx)("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-6 shadow-sm border border-white/20",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-green-400 to-blue-400 rounded-full flex items-center justify-center",children:(0,r.jsx)("span",{className:"text-white font-semibold text-lg",children:e.from_user.full_name?.charAt(0)||e.from_user.email?.charAt(0)||"?"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-semibold text-gray-900",children:e.from_user.full_name||"Unknown User"}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:e.from_user.email}),(0,r.jsxs)("p",{className:"text-xs text-gray-500",children:["Sent ",new Date(e.created_at).toLocaleDateString()]})]})]}),(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)("button",{onClick:()=>j(e.id),className:"bg-green-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-green-700 transition-colors",children:"Accept"}),(0,r.jsx)("button",{onClick:()=>N(e.id),className:"bg-gray-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-gray-700 transition-colors",children:"Decline"})]})]})},e.id))})}),"search"===x&&(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-6 shadow-sm border border-white/20",children:(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("input",{type:"text",placeholder:"Search by name, email, or username...",value:h,onChange:e=>y(e.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"}),(0,r.jsx)("svg",{className:"absolute left-3 top-3.5 h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})]})}),f.length>0&&(0,r.jsx)("div",{className:"space-y-4",children:f.map(e=>(0,r.jsx)("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-6 shadow-sm border border-white/20",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-purple-400 to-pink-400 rounded-full flex items-center justify-center",children:(0,r.jsx)("span",{className:"text-white font-semibold text-lg",children:e.full_name?.charAt(0)||e.email?.charAt(0)||"?"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-semibold text-gray-900",children:e.full_name||"Unknown User"}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:e.email}),e.username&&(0,r.jsxs)("p",{className:"text-xs text-gray-500",children:["@",e.username]})]})]}),(0,r.jsx)("button",{onClick:()=>v(e.id),className:"bg-gradient-to-r from-purple-600 to-blue-600 text-white px-4 py-2 rounded-lg font-medium hover:from-purple-700 hover:to-blue-700 transition-all",children:"Add Friend"})]})},e.id))}),h.length>2&&0===f.length&&(0,r.jsx)("div",{className:"text-center py-8 bg-white/60 backdrop-blur-sm rounded-xl",children:(0,r.jsxs)("p",{className:"text-gray-600",children:['No users found matching "',h,'"']})})]})]})]})}e.s(["default",()=>n])}]);