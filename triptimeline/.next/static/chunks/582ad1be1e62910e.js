(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,74765,t=>{"use strict";let e=(0,t.i(38335).createClient)(),r=t=>{if(!t)return null;let e=t.trim().toLowerCase();if(!e)return null;let r=e.match(/^(\d{1,2})(?::(\d{2}))?\s*(am|pm)?$/i);if(!r)return null;let a=parseInt(r[1],10),i=r[2]?parseInt(r[2],10):0,o=r[3]?.toLowerCase();return Number.isNaN(a)||Number.isNaN(i)||i<0||i>59||("am"===o?a%=12:"pm"===o&&(a=a%12+12),a<0||a>23)?null:`${a.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`};async function a(t,r,a){let i=new Date(r),o=Math.ceil((new Date(a).getTime()-i.getTime())/864e5)+1,d=[];for(let e=0;e<o;e++){let r=new Date(i);r.setDate(i.getDate()+e);let a=0===e?"Arrival Day":e===o-1?"Departure Day":`Day ${e+1}`;d.push({trip_id:t,date:r.toISOString().split("T")[0],day_index:e+1,title:a})}let{error:n}=await e.from("trip_days").insert(d);if(n){if(n.message&&n.message.includes("duplicate key"))return;throw Error(`Failed to create trip days: ${n.message}`)}}function i(t,e,r,a){return{id:t.id,title:t.title,destination:t.destination,start_date:t.start_date,end_date:t.end_date,description:t.description||"",budget:t.budget||0,currency:t.currency,travelers:1,packingList:r,expenses:a,itinerary:e,created_at:t.created_at,updated_at:t.updated_at}}function o(t){let e=r(t.start_time)??t.start_time??"";return{id:t.id,title:t.title,time:e,description:t.notes??void 0,location:t.location_name??void 0,type:(t=>{if(!t)return"morning";let[e]=t.split(":"),r=parseInt(e,10);return Number.isNaN(r)?"morning":r>=17?"evening":r>=12?"afternoon":"morning"})(e),category:t.category||"other",cost:t.cost_amount??void 0,duration:60,notes:t.notes??void 0,completed:!1}}function d(t){return{id:t.id,name:t.name,category:t.category||"other",quantity:1,packed:t.is_checked,essential:1===t.priority,notes:""}}function n(t){return{id:t.id,title:t.label,amount:t.amount,currency:t.currency,category:t.category||"other",date:t.created_at.split("T")[0],description:"",shared:!1}}async function s(t){let{data:{user:r}}=await e.auth.getUser();if(!r)throw Error("User not authenticated - please log in again");let{data:i,error:o}=await e.from("trips").insert({user_id:r.id,title:t.title,destination:t.destination,start_date:t.start_date,end_date:t.end_date,description:t.description,currency:t.currency}).select().single();if(o)throw Error(`Database error: ${o.message}`);if(!i)throw Error("No data returned from trip creation");try{await a(i.id,t.start_date,t.end_date)}catch(t){}return i.id}async function l(t){let{data:{user:r}}=await e.auth.getUser();if(!r)return null;let{data:a,error:s}=await e.from("trips").select("*").eq("id",t).single();if(s||!a)return null;if(a.user_id!==r.id){let{data:a}=await e.from("trip_collaborators").select("id").eq("trip_id",t).eq("user_id",r.id).eq("status","accepted").single();if(!a)return null}let{data:l,error:c}=await e.from("trip_days").select("*").eq("trip_id",t).order("day_index");if(c)throw c;let u=[];for(let t of l||[]){let{data:r,error:a}=await e.from("events").select("*").eq("trip_day_id",t.id).order("order_index");if(a)throw a;let i=(r||[]).map(o);u.push({day:t.day_index,date:t.date,activities:i,notes:t.notes||"",actualSpent:0,customTitle:t.title})}let{data:p,error:f}=await e.from("packing_items").select("*").eq("trip_id",t);if(f)throw f;let m=(p||[]).map(d),{data:w,error:g}=await e.from("expenses").select("*").eq("trip_id",t);if(g)throw g;return i(a,u,m,(w||[]).map(n))}async function c(){let{data:{user:t}}=await e.auth.getUser();if(!t)return[];let{data:r,error:a}=await e.from("trips").select("*").eq("user_id",t.id).order("created_at",{ascending:!1});if(a)throw a;let{data:o,error:d}=await e.from("trips").select("*").in("id",(await e.from("trip_collaborators").select("trip_id").eq("user_id",t.id).eq("status","accepted")).data?.map(t=>t.trip_id)||[]).order("created_at",{ascending:!1});if(d&&"PGRST116"!==d.code)throw d;return Array.from(new Map([...r||[],...o||[]].map(t=>[t.id,t])).values()).map(t=>i(t,[],[],[]))}async function u(t,r,a){let{data:{user:i}}=await e.auth.getUser();if(!i)return;let{data:o,error:d}=await e.from("trip_days").select("*").eq("trip_id",t).eq("day_index",r).single();if(d||!o)try{let{data:r}=await e.from("trips").select("start_date").eq("id",t).single();if(r)return;throw Error("Trip not found")}catch(t){throw Error(`Trip day not found and could not be created: ${t}`)}let n={};if(void 0!==a.customTitle&&(n.title=a.customTitle),void 0!==a.notes&&(n.notes=a.notes),Object.keys(n).length>0){let{error:t}=await e.from("trip_days").update(n).eq("id",o?.id);if(t)throw Error(`Failed to update trip day: ${t.message||JSON.stringify(t)}`)}}async function p(t,r){let{data:{user:a}}=await e.auth.getUser();if(!a)throw Error("User not authenticated");let{data:i,error:o}=await e.from("trip_days").select("id").eq("trip_id",t).eq("day_index",r).single();if(o||!i)return;let{error:d}=await e.from("trip_days").delete().eq("id",i.id);if(d)throw Error(`Failed to delete trip day: ${d.message}`)}async function f(t,a,i){let{data:{user:d}}=await e.auth.getUser();if(!d)throw Error("User not authenticated");let{data:n,error:s}=await e.from("trip_days").select("id").eq("trip_id",t).eq("day_index",a).single();if(s||!n)throw Error("Trip day not found");let l=r(i.time),{data:c,error:u}=await e.from("events").insert({trip_day_id:n.id,title:i.title,start_time:l,category:i.category||"other",location_name:i.location??null,cost_amount:i.cost??null,cost_currency:i.cost?"USD":null,notes:i.description??null,order_index:0}).select().single();if(u)throw Error(`Failed to add activity: ${u.message}`);if(!c)throw Error("No data returned when creating activity");return o(c)}async function m(t,a,i,d){let{data:{user:n}}=await e.auth.getUser();if(!n)throw Error("User not authenticated");let{data:s,error:l}=await e.from("trip_days").select("id").eq("trip_id",t).eq("day_index",a).single();if(l||!s)throw Error("Trip day not found");let c=r(d.time),{data:u,error:p}=await e.from("events").update({title:d.title,start_time:c,category:d.category||"other",location_name:d.location??null,cost_amount:d.cost??null,notes:d.description??null}).eq("id",i).eq("trip_day_id",s.id).select().single();if(p)throw Error(`Failed to update activity: ${p.message}`);if(!u)throw Error("No data returned when updating activity");return o(u)}async function w(t,r,a){let{data:{user:i}}=await e.auth.getUser();if(!i)throw Error("User not authenticated");let{data:o,error:d}=await e.from("trip_days").select("id").eq("trip_id",t).eq("day_index",r).single();if(d||!o)throw Error("Trip day not found");let{error:n}=await e.from("events").delete().eq("id",a).eq("trip_day_id",o.id);if(n)throw Error(`Failed to delete activity: ${n.message}`)}async function g(t){let{data:{user:r}}=await e.auth.getUser();if(!r)throw Error("User not authenticated");let{error:a}=await e.from("trips").delete().eq("id",t).eq("user_id",r.id);if(a)throw Error(`Failed to delete trip: ${a.message}`)}async function y(t,r){let{data:{user:a}}=await e.auth.getUser();if(!a)throw Error("User not authenticated");let{error:i}=await e.from("packing_items").insert({trip_id:t,name:r.name,category:r.category,is_checked:r.packed,priority:r.essential?1:2});if(i)throw i}async function _(t,r){let{data:{user:a}}=await e.auth.getUser();if(!a)throw Error("User not authenticated");if(await e.from("packing_items").delete().eq("trip_id",t),r.length>0){let a=r.map(e=>({trip_id:t,name:e.name,category:e.category,is_checked:e.packed,priority:e.essential?1:2})),{error:i}=await e.from("packing_items").insert(a);if(i)throw i}}async function h(t,r){let{data:{user:a}}=await e.auth.getUser();if(!a)throw Error("User not authenticated");let{error:i}=await e.from("expenses").insert({trip_id:t,label:r.title,amount:r.amount,currency:r.currency,category:r.category});if(i)throw Error(`Failed to add expense: ${i.message||JSON.stringify(i)}`)}async function E(t,r,a,i,o,d){let{data:{user:n}}=await e.auth.getUser();if(!n)throw Error("User not authenticated");let{data:s,error:l}=await e.from("trip_days").select("id").eq("trip_id",t).eq("day_index",r).single();if(l||!s)throw Error("Trip day not found");let c=a.name.split(".").pop(),u=`${t}/${s.id}/${Date.now()}.${c}`,p=`media/${u}`,{error:f}=await e.storage.from("trip-media").upload(p,a,{upsert:!1});if(f)throw Error(`Failed to upload file: ${f.message}`);let{data:m}=e.storage.from("trip-media").getPublicUrl(p),w=m.publicUrl,{error:g}=await e.from("media").insert({trip_day_id:s.id,type:i,url:w,title:o||a.name,description:d||""});if(g)throw Error(`Failed to save media record: ${g.message||JSON.stringify(g)}`)}async function q(t){let{data:{user:r}}=await e.auth.getUser();if(!r)throw Error("User not authenticated");let{data:a,error:i}=await e.from("media").select("url").eq("id",t).single();if(i||!a)throw Error("Media not found");let o=new URL(a.url).pathname.split("/storage/v1/object/public/trip-media/")[1],{error:d}=await e.storage.from("trip-media").remove([o]),{error:n}=await e.from("media").delete().eq("id",t);if(n)throw Error(`Failed to delete media: ${n.message}`)}async function v(t,r){let{data:a,error:i}=await e.from("trip_days").select("id").eq("trip_id",t).eq("day_index",r).single();if(i||!a)return[];let{data:o,error:d}=await e.from("media").select("*").eq("trip_day_id",a.id).order("created_at",{ascending:!1});return d?[]:o||[]}async function U(t,r){let{data:{user:a}}=await e.auth.getUser();if(!a)throw Error("User not authenticated");let i={};void 0!==r.title&&(i.title=r.title),void 0!==r.description&&(i.description=r.description),void 0!==r.budget&&(i.budget=r.budget),void 0!==r.currency&&(i.currency=r.currency),void 0!==r.start_date&&(i.start_date=r.start_date),void 0!==r.end_date&&(i.end_date=r.end_date);let{error:o}=await e.from("trips").update(i).eq("id",t).eq("user_id",a.id);if(o)throw Error(`Failed to update trip: ${o.message}`)}async function $(t){let{data:{user:r}}=await e.auth.getUser();if(!r)throw Error("User not authenticated");let{error:a}=await e.from("expenses").delete().eq("id",t);if(a)throw Error(`Failed to delete expense: ${a.message}`)}async function T(t,r){let{data:{user:a}}=await e.auth.getUser();if(!a)throw Error("User not authenticated");let i=r.name.split(".").pop(),o=`${t}/cover-${Date.now()}.${i}`,d=`trip-covers/${o}`,{error:n}=await e.storage.from("trip-media").upload(d,r,{upsert:!0});if(n)throw Error(`Failed to upload cover image: ${n.message}`);let{data:s}=e.storage.from("trip-media").getPublicUrl(d),l=s.publicUrl,{error:c}=await e.from("trips").update({cover_image:l}).eq("id",t);if(c)throw Error(`Failed to save cover image: ${c.message}`);return l}t.s(["addActivity",()=>f,"addExpense",()=>h,"addPackingItem",()=>y,"createTrip",()=>s,"deleteActivity",()=>w,"deleteExpense",()=>$,"deleteMedia",()=>q,"deleteTrip",()=>g,"deleteTripDay",()=>p,"getMediaForDay",()=>v,"getTrip",()=>l,"getUserTrips",()=>c,"savePackingList",()=>_,"updateActivity",()=>m,"updateTrip",()=>U,"updateTripDay",()=>u,"uploadMedia",()=>E,"uploadTripCoverImage",()=>T])}]);