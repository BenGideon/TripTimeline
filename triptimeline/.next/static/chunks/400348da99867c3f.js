(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,70267,(e,r,t)=>{r.exports=e.r(26656)},11069,e=>{"use strict";let r=(0,e.i(38335).createClient)();async function t(){let{data:{user:e}}=await r.auth.getUser();if(!e)return null;let{data:t,error:s}=await r.from("user_profiles").select("*").eq("id",e.id).single();return s?null:t}async function s(e){let{data:{user:t}}=await r.auth.getUser();if(!t)throw Error("User not authenticated");let{error:s}=await r.from("user_profiles").update(e).eq("id",t.id);if(s)throw Error(`Failed to update profile: ${s.message}`)}async function i(e){let{data:{user:t}}=await r.auth.getUser();if(!t)return[];let{data:s,error:i}=await r.from("user_profiles").select("*").or(`full_name.ilike.%${e}%,email.ilike.%${e}%,username.ilike.%${e}%`).neq("id",t.id).limit(10);return i?[]:s||[]}async function a(e){let{data:{user:t}}=await r.auth.getUser();if(!t)throw Error("User not authenticated");let{error:s}=await r.from("friends").insert({user_id:t.id,friend_id:e,status:"pending"});if(s){if("23505"===s.code||s.message?.includes("friends_user_id_friend_id_key")){let e=Error("FRIEND_REQUEST_ALREADY_EXISTS");throw e.code="FRIEND_REQUEST_ALREADY_EXISTS",e}throw Error(`Failed to send friend request: ${s.message}`)}}async function n(e){let{data:{user:t}}=await r.auth.getUser();if(!t)throw Error("User not authenticated");let{error:s}=await r.from("friends").update({status:"accepted"}).eq("id",e).eq("friend_id",t.id);if(s)throw Error(`Failed to accept friend request: ${s.message}`);let{data:i}=await r.from("friends").select("user_id, friend_id").eq("id",e).single();if(i){let{error:e}=await r.from("friends").insert({user_id:t.id,friend_id:i.user_id,status:"accepted"});e&&e.message.includes("duplicate")}}async function d(e){let{data:{user:t}}=await r.auth.getUser();if(!t)throw Error("User not authenticated");let{error:s}=await r.from("friends").delete().eq("id",e).eq("friend_id",t.id);if(s)throw Error(`Failed to decline friend request: ${s.message}`)}async function o(e){let{data:{user:t}}=await r.auth.getUser();if(!t)throw Error("User not authenticated");let{error:s}=await r.from("friends").delete().eq("user_id",t.id).eq("friend_id",e),{error:i}=await r.from("friends").delete().eq("user_id",e).eq("friend_id",t.id);if(s||i)throw Error("Failed to remove friend")}async function l(){let{data:{user:e}}=await r.auth.getUser();if(!e)return[];try{let{data:t,error:s}=await r.from("friends").select(`
        *,
        friend_profile:user_profiles!friends_friend_id_fkey(*)
      `).eq("user_id",e.id).eq("status","accepted");if(s)return s.message?.includes('relation "public.friends" does not exist')||s.message?.includes('relation "public.user_profiles" does not exist'),[];return t||[]}catch(e){return[]}}async function c(){let{data:{user:e}}=await r.auth.getUser();if(!e)return[];try{let{data:t,error:s}=await r.from("friends").select(`
        id,
        status,
        created_at,
        from_user:user_profiles!friends_user_id_fkey(*),
        to_user:user_profiles!friends_friend_id_fkey(*)
      `).eq("friend_id",e.id).eq("status","pending");if(s){if(s.message?.includes('relation "public.friends" does not exist'))throw Error("FRIENDS_TABLE_MISSING");return[]}return t||[]}catch(e){if("FRIENDS_TABLE_MISSING"===e.message)throw e;return[]}}async function u(e,t,s="viewer"){let{data:{user:i}}=await r.auth.getUser();if(!i)throw Error("User not authenticated");let{error:a}=await r.from("trip_collaborators").insert({trip_id:e,user_id:t,role:s,invited_by:i.id,status:"pending"});if(a){if("23505"===a.code||a.message?.includes("trip_collaborators_trip_id_user_id_key")){let e=Error("TRIP_COLLABORATOR_ALREADY_INVITED");throw e.code="TRIP_COLLABORATOR_ALREADY_INVITED",e}throw Error(`Failed to invite user to trip: ${a.message}`)}}async function m(e){let{data:{user:t}}=await r.auth.getUser();if(!t)throw Error("User not authenticated");let{data:s,error:i}=await r.from("trip_collaborators").update({status:"accepted"}).eq("id",e).eq("user_id",t.id);if(i)throw Error(`Failed to accept trip invitation: ${i.message}`)}async function f(e){let{data:{user:t}}=await r.auth.getUser();if(!t)throw Error("User not authenticated");let{error:s}=await r.from("trip_collaborators").update({status:"declined"}).eq("id",e).eq("user_id",t.id);if(s)throw Error(`Failed to decline trip invitation: ${s.message}`)}async function h(e,t){let{data:{user:s}}=await r.auth.getUser();if(!s)throw Error("User not authenticated");let{error:i}=await r.from("trip_collaborators").delete().eq("trip_id",e).eq("user_id",t);if(i)throw Error(`Failed to remove user from trip: ${i.message}`)}async function p(e){let{data:t,error:s}=await r.from("trip_collaborators").select(`
      *,
      user_profile:user_profiles!trip_collaborators_user_id_fkey(*),
      inviter_profile:user_profiles!trip_collaborators_invited_by_fkey(*)
    `).eq("trip_id",e).eq("status","accepted");return s?[]:t||[]}async function x(){let{data:{user:e}}=await r.auth.getUser();if(!e)return[];try{let{data:t,error:s}=await r.from("trip_collaborators").select(`
        id,
        role,
        status,
        created_at,
        trip:trips(id, title, destination, start_date, end_date)
      `).eq("user_id",e.id).eq("status","pending");if(s){if(s.message?.includes('relation "public.trip_collaborators" does not exist')||s.message?.includes('relation "public.user_profiles" does not exist'))throw Error("FRIENDS_TABLE_MISSING");return[]}return t||[]}catch(e){if("FRIENDS_TABLE_MISSING"===e.message)throw e;return[]}}async function g(e,t,s){let{data:{user:i}}=await r.auth.getUser();if(!i)throw Error("User not authenticated");let{error:a}=await r.from("trip_collaborators").update({role:s}).eq("trip_id",e).eq("user_id",t);if(a)throw Error(`Failed to update collaborator role: ${a.message}`)}async function y(e){let{data:{user:t}}=await r.auth.getUser();if(!t)return!1;let{data:s}=await r.from("trips").select("user_id").eq("id",e).single();if(s&&s.user_id===t.id)return!0;let{data:i}=await r.from("trip_collaborators").select("role").eq("trip_id",e).eq("user_id",t.id).eq("status","accepted").single();return i&&("editor"===i.role||"owner"===i.role)}e.s(["acceptFriendRequest",()=>n,"acceptTripInvitation",()=>m,"canEditTrip",()=>y,"declineFriendRequest",()=>d,"declineTripInvitation",()=>f,"getCurrentUserProfile",()=>t,"getFriendRequests",()=>c,"getFriends",()=>l,"getTripCollaborators",()=>p,"getTripInvitations",()=>x,"inviteToTrip",()=>u,"removeFriend",()=>o,"removeFromTrip",()=>h,"searchUsers",()=>i,"sendFriendRequest",()=>a,"updateCollaboratorRole",()=>g,"updateUserProfile",()=>s])},91494,e=>{"use strict";var r=e.i(21227),t=e.i(61013),s=e.i(84961),i=e.i(70267),a=e.i(11069);function n(){let{user:e,loading:n}=(0,s.useAuth)(),d=(0,i.useRouter)(),[o,l]=(0,t.useState)([]),[c,u]=(0,t.useState)([]),[m,f]=(0,t.useState)([]),[h,p]=(0,t.useState)(""),[x,g]=(0,t.useState)("friends"),[y,_]=(0,t.useState)(!0);(0,t.useEffect)(()=>{n||e||d.push("/auth/login")},[e,n,d]),(0,t.useEffect)(()=>{e&&w()},[e]);let w=async()=>{try{let[e,r]=await Promise.all([(0,a.getFriends)(),(0,a.getFriendRequests)()]);l(e),u(r)}catch(e){console.error("Error loading friends data:",e)}finally{_(!1)}},j=async e=>{if(p(e),e.trim().length>2)try{let r=await (0,a.searchUsers)(e);f(r)}catch(e){console.error("Error searching users:",e)}else f([])},v=async e=>{try{await (0,a.sendFriendRequest)(e),f(m.filter(r=>r.id!==e)),alert("Friend request sent!")}catch(e){console.error("Error sending friend request:",e),e?.code==="FRIEND_REQUEST_ALREADY_EXISTS"?alert("Friend request already sent. Wait for them to respond."):alert("Failed to send friend request")}},b=async e=>{try{await (0,a.acceptFriendRequest)(e),await w()}catch(e){console.error("Error accepting friend request:",e),alert("Failed to accept friend request")}},N=async e=>{try{await (0,a.declineFriendRequest)(e),u(c.filter(r=>r.id!==e))}catch(e){console.error("Error declining friend request:",e),alert("Failed to decline friend request")}},E=async e=>{if(window.confirm("Are you sure you want to remove this friend?"))try{await (0,a.removeFriend)(e),l(o.filter(r=>r.friend_id!==e))}catch(e){console.error("Error removing friend:",e),alert("Failed to remove friend")}};return n||y?(0,r.jsx)("div",{className:"min-h-screen bg-bg flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-secondary",children:"Loading friends..."})]})}):(0,r.jsxs)("div",{className:"min-h-screen bg-bg",children:[(0,r.jsx)("div",{className:"glass sticky top-0 z-10",children:(0,r.jsx)("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,r.jsx)("div",{className:"flex items-center justify-between h-16",children:(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsx)("button",{onClick:()=>d.push("/dashboard"),className:"text-secondary hover:text-primary transition-colors",children:"â† Back to Dashboard"}),(0,r.jsx)("h1",{className:"text-2xl font-bold text-primary",children:"Friends"})]})})})}),(0,r.jsxs)("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,r.jsxs)("div",{className:"flex space-x-1 glass rounded-lg p-1 mb-8",children:[(0,r.jsxs)("button",{onClick:()=>g("friends"),className:`flex-1 py-2 px-4 rounded-lg font-medium transition-all ${"friends"===x?"btn-primary":"text-secondary hover:text-primary"}`,children:["Friends (",o.length,")"]}),(0,r.jsxs)("button",{onClick:()=>g("requests"),className:`flex-1 py-2 px-4 rounded-lg font-medium transition-all ${"requests"===x?"btn-primary":"text-secondary hover:text-primary"}`,children:["Requests (",c.length,")"]}),(0,r.jsx)("button",{onClick:()=>g("search"),className:`flex-1 py-2 px-4 rounded-lg font-medium transition-all ${"search"===x?"btn-primary":"text-secondary hover:text-primary"}`,children:"Add Friends"})]}),"friends"===x&&(0,r.jsx)("div",{className:"space-y-4",children:0===o.length?(0,r.jsxs)("div",{className:"text-center py-12 glass rounded-xl",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-primary bg-opacity-10 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,r.jsx)("svg",{className:"w-8 h-8 text-primary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"})})}),(0,r.jsx)("h3",{className:"text-lg font-medium text-primary mb-2",children:"No friends yet"}),(0,r.jsx)("p",{className:"text-secondary mb-4",children:"Start building your travel network!"}),(0,r.jsx)("button",{onClick:()=>g("search"),className:"btn-primary px-6 py-2 rounded-lg font-medium transition-all",children:"Add Friends"})]}):(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:o.map(e=>(0,r.jsx)("div",{className:"glass rounded-lg p-6 shadow-md",children:(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-primary to-secondary rounded-full flex items-center justify-center",children:(0,r.jsx)("span",{className:"text-white font-semibold text-lg",children:e.friend_profile?.full_name?.charAt(0)||e.friend_profile?.email?.charAt(0)||"?"})}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("h3",{className:"font-semibold text-primary",children:e.friend_profile?.full_name||"Unknown User"}),(0,r.jsx)("p",{className:"text-sm text-secondary",children:e.friend_profile?.email})]}),(0,r.jsx)("button",{onClick:()=>E(e.friend_id),className:"text-accent hover:text-primary p-2 rounded-lg hover:bg-accent hover:bg-opacity-10 transition-colors",title:"Remove friend",children:(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})},e.id))})}),"requests"===x&&(0,r.jsx)("div",{className:"space-y-4",children:0===c.length?(0,r.jsxs)("div",{className:"text-center py-12 glass rounded-xl",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-secondary bg-opacity-10 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,r.jsx)("svg",{className:"w-8 h-8 text-secondary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"})})}),(0,r.jsx)("h3",{className:"text-lg font-medium text-primary mb-2",children:"No pending requests"}),(0,r.jsx)("p",{className:"text-secondary",children:"You're all caught up!"})]}):(0,r.jsx)("div",{className:"space-y-4",children:c.map(e=>(0,r.jsx)("div",{className:"glass rounded-lg p-6 shadow-md",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-secondary to-accent rounded-full flex items-center justify-center",children:(0,r.jsx)("span",{className:"text-white font-semibold text-lg",children:e.from_user.full_name?.charAt(0)||e.from_user.email?.charAt(0)||"?"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-semibold text-primary",children:e.from_user.full_name||"Unknown User"}),(0,r.jsx)("p",{className:"text-sm text-secondary",children:e.from_user.email}),(0,r.jsxs)("p",{className:"text-xs text-secondary text-opacity-60",children:["Sent"," ",new Date(e.created_at).toLocaleDateString()]})]})]}),(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)("button",{onClick:()=>b(e.id),className:"btn-primary px-4 py-2 rounded-lg font-medium transition-colors",children:"Accept"}),(0,r.jsx)("button",{onClick:()=>N(e.id),className:"glass text-secondary px-4 py-2 rounded-lg font-medium transition-colors",children:"Decline"})]})]})},e.id))})}),"search"===x&&(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("div",{className:"glass rounded-lg p-6 shadow-md",children:(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("input",{type:"text",placeholder:"Search by name, email, or username...",value:h,onChange:e=>j(e.target.value),className:"w-full pl-10 pr-4 py-3 border border-secondary border-opacity-20 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent bg-white text-primary placeholder-secondary"}),(0,r.jsx)("svg",{className:"absolute left-3 top-3.5 h-5 w-5 text-secondary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})]})}),m.length>0&&(0,r.jsx)("div",{className:"space-y-4",children:m.map(e=>(0,r.jsx)("div",{className:"glass rounded-lg p-6 shadow-md",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-accent to-primary rounded-full flex items-center justify-center",children:(0,r.jsx)("span",{className:"text-white font-semibold text-lg",children:e.full_name?.charAt(0)||e.email?.charAt(0)||"?"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-semibold text-primary",children:e.full_name||"Unknown User"}),(0,r.jsx)("p",{className:"text-sm text-secondary",children:e.email}),e.username&&(0,r.jsxs)("p",{className:"text-xs text-secondary text-opacity-60",children:["@",e.username]})]})]}),(0,r.jsx)("button",{onClick:()=>v(e.id),className:"btn-primary px-4 py-2 rounded-lg font-medium transition-all",children:"Add Friend"})]})},e.id))}),h.length>2&&0===m.length&&(0,r.jsx)("div",{className:"text-center py-8 glass rounded-lg",children:(0,r.jsxs)("p",{className:"text-secondary",children:['No users found matching "',h,'"']})})]})]})]})}e.s(["default",()=>n])}]);