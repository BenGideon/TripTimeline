module.exports=[64448,a=>{"use strict";let b=(0,a.i(14523).createClient)(),c=a=>{if(!a)return null;let b=a.trim().toLowerCase();if(!b)return null;let c=b.match(/^(\d{1,2})(?::(\d{2}))?\s*(am|pm)?$/i);if(!c)return null;let d=parseInt(c[1],10),e=c[2]?parseInt(c[2],10):0,f=c[3]?.toLowerCase();return Number.isNaN(d)||Number.isNaN(e)||e<0||e>59||("am"===f?d%=12:"pm"===f&&(d=d%12+12),d<0||d>23)?null:`${d.toString().padStart(2,"0")}:${e.toString().padStart(2,"0")}`};async function d(a,c,d){let e=new Date(c),f=Math.ceil((new Date(d).getTime()-e.getTime())/864e5)+1,g=[];for(let b=0;b<f;b++){let c=new Date(e);c.setDate(e.getDate()+b);let d=0===b?"Arrival Day":b===f-1?"Departure Day":`Day ${b+1}`;g.push({trip_id:a,date:c.toISOString().split("T")[0],day_index:b+1,title:d})}let{error:h}=await b.from("trip_days").insert(g);if(h){if(h.message&&h.message.includes("duplicate key"))return;throw Error(`Failed to create trip days: ${h.message}`)}}function e(a,b,c,d){return{id:a.id,title:a.title,destination:a.destination,start_date:a.start_date,end_date:a.end_date,description:a.description||"",budget:a.budget||0,currency:a.currency,travelers:1,packingList:c,expenses:d,itinerary:b,created_at:a.created_at,updated_at:a.updated_at}}function f(a){let b=c(a.start_time)??a.start_time??"";return{id:a.id,title:a.title,time:b,description:a.notes??void 0,location:a.location_name??void 0,type:(a=>{if(!a)return"morning";let[b]=a.split(":"),c=parseInt(b,10);return Number.isNaN(c)?"morning":c>=17?"evening":c>=12?"afternoon":"morning"})(b),category:a.category||"other",cost:a.cost_amount??void 0,duration:60,notes:a.notes??void 0,completed:!1}}function g(a){return{id:a.id,name:a.name,category:a.category||"other",quantity:1,packed:a.is_checked,essential:1===a.priority,notes:""}}function h(a){return{id:a.id,title:a.label,amount:a.amount,currency:a.currency,category:a.category||"other",date:a.created_at.split("T")[0],description:"",shared:!1}}async function i(a){let{data:{user:c}}=await b.auth.getUser();if(!c)throw Error("User not authenticated - please log in again");let{data:e,error:f}=await b.from("trips").insert({user_id:c.id,title:a.title,destination:a.destination,start_date:a.start_date,end_date:a.end_date,description:a.description,currency:a.currency}).select().single();if(f)throw Error(`Database error: ${f.message}`);if(!e)throw Error("No data returned from trip creation");try{await d(e.id,a.start_date,a.end_date)}catch(a){}return e.id}async function j(a){let{data:{user:c}}=await b.auth.getUser();if(!c)return null;let{data:d,error:i}=await b.from("trips").select("*").eq("id",a).single();if(i||!d)return null;if(d.user_id!==c.id){let{data:d}=await b.from("trip_collaborators").select("id").eq("trip_id",a).eq("user_id",c.id).eq("status","accepted").single();if(!d)return null}let{data:j,error:k}=await b.from("trip_days").select("*").eq("trip_id",a).order("day_index");if(k)throw k;let l=[];for(let a of j||[]){let{data:c,error:d}=await b.from("events").select("*").eq("trip_day_id",a.id).order("order_index");if(d)throw d;let e=(c||[]).map(f);l.push({day:a.day_index,date:a.date,activities:e,notes:a.notes||"",actualSpent:0,customTitle:a.title})}let{data:m,error:n}=await b.from("packing_items").select("*").eq("trip_id",a);if(n)throw n;let o=(m||[]).map(g),{data:p,error:q}=await b.from("expenses").select("*").eq("trip_id",a);if(q)throw q;return e(d,l,o,(p||[]).map(h))}async function k(){let{data:{user:a}}=await b.auth.getUser();if(!a)return[];let{data:c,error:d}=await b.from("trips").select("*").eq("user_id",a.id).order("created_at",{ascending:!1});if(d)throw d;let{data:f,error:g}=await b.from("trips").select("*").in("id",(await b.from("trip_collaborators").select("trip_id").eq("user_id",a.id).eq("status","accepted")).data?.map(a=>a.trip_id)||[]).order("created_at",{ascending:!1});if(g&&"PGRST116"!==g.code)throw g;return Array.from(new Map([...c||[],...f||[]].map(a=>[a.id,a])).values()).map(a=>e(a,[],[],[]))}async function l(a,c,d){let{data:{user:e}}=await b.auth.getUser();if(!e)return;let{data:f,error:g}=await b.from("trip_days").select("*").eq("trip_id",a).eq("day_index",c).single();if(g||!f)try{let{data:c}=await b.from("trips").select("start_date").eq("id",a).single();if(c)return;throw Error("Trip not found")}catch(a){throw Error(`Trip day not found and could not be created: ${a}`)}let h={};if(void 0!==d.customTitle&&(h.title=d.customTitle),void 0!==d.notes&&(h.notes=d.notes),Object.keys(h).length>0){let{error:a}=await b.from("trip_days").update(h).eq("id",f?.id);if(a)throw Error(`Failed to update trip day: ${a.message||JSON.stringify(a)}`)}}async function m(a,c){let{data:{user:d}}=await b.auth.getUser();if(!d)throw Error("User not authenticated");let{data:e,error:f}=await b.from("trip_days").select("id").eq("trip_id",a).eq("day_index",c).single();if(f||!e)return;let{error:g}=await b.from("trip_days").delete().eq("id",e.id);if(g)throw Error(`Failed to delete trip day: ${g.message}`)}async function n(a,d,e){let{data:{user:g}}=await b.auth.getUser();if(!g)throw Error("User not authenticated");let{data:h,error:i}=await b.from("trip_days").select("id").eq("trip_id",a).eq("day_index",d).single();if(i||!h)throw Error("Trip day not found");let j=c(e.time),{data:k,error:l}=await b.from("events").insert({trip_day_id:h.id,title:e.title,start_time:j,category:e.category||"other",location_name:e.location??null,cost_amount:e.cost??null,cost_currency:e.cost?"USD":null,notes:e.description??null,order_index:0}).select().single();if(l)throw Error(`Failed to add activity: ${l.message}`);if(!k)throw Error("No data returned when creating activity");return f(k)}async function o(a,d,e,g){let{data:{user:h}}=await b.auth.getUser();if(!h)throw Error("User not authenticated");let{data:i,error:j}=await b.from("trip_days").select("id").eq("trip_id",a).eq("day_index",d).single();if(j||!i)throw Error("Trip day not found");let k=c(g.time),{data:l,error:m}=await b.from("events").update({title:g.title,start_time:k,category:g.category||"other",location_name:g.location??null,cost_amount:g.cost??null,notes:g.description??null}).eq("id",e).eq("trip_day_id",i.id).select().single();if(m)throw Error(`Failed to update activity: ${m.message}`);if(!l)throw Error("No data returned when updating activity");return f(l)}async function p(a,c,d){let{data:{user:e}}=await b.auth.getUser();if(!e)throw Error("User not authenticated");let{data:f,error:g}=await b.from("trip_days").select("id").eq("trip_id",a).eq("day_index",c).single();if(g||!f)throw Error("Trip day not found");let{error:h}=await b.from("events").delete().eq("id",d).eq("trip_day_id",f.id);if(h)throw Error(`Failed to delete activity: ${h.message}`)}async function q(a){let{data:{user:c}}=await b.auth.getUser();if(!c)throw Error("User not authenticated");let{error:d}=await b.from("trips").delete().eq("id",a).eq("user_id",c.id);if(d)throw Error(`Failed to delete trip: ${d.message}`)}async function r(a,c){let{data:{user:d}}=await b.auth.getUser();if(!d)throw Error("User not authenticated");let{error:e}=await b.from("packing_items").insert({trip_id:a,name:c.name,category:c.category,is_checked:c.packed,priority:c.essential?1:2});if(e)throw e}async function s(a,c){let{data:{user:d}}=await b.auth.getUser();if(!d)throw Error("User not authenticated");if(await b.from("packing_items").delete().eq("trip_id",a),c.length>0){let d=c.map(b=>({trip_id:a,name:b.name,category:b.category,is_checked:b.packed,priority:b.essential?1:2})),{error:e}=await b.from("packing_items").insert(d);if(e)throw e}}async function t(a,c){let{data:{user:d}}=await b.auth.getUser();if(!d)throw Error("User not authenticated");let{error:e}=await b.from("expenses").insert({trip_id:a,label:c.title,amount:c.amount,currency:c.currency,category:c.category});if(e)throw Error(`Failed to add expense: ${e.message||JSON.stringify(e)}`)}async function u(a,c,d,e,f,g){let{data:{user:h}}=await b.auth.getUser();if(!h)throw Error("User not authenticated");let{data:i,error:j}=await b.from("trip_days").select("id").eq("trip_id",a).eq("day_index",c).single();if(j||!i)throw Error("Trip day not found");let k=d.name.split(".").pop(),l=`${a}/${i.id}/${Date.now()}.${k}`,m=`media/${l}`,{error:n}=await b.storage.from("trip-media").upload(m,d,{upsert:!1});if(n)throw Error(`Failed to upload file: ${n.message}`);let{data:o}=b.storage.from("trip-media").getPublicUrl(m),p=o.publicUrl,{error:q}=await b.from("media").insert({trip_day_id:i.id,type:e,url:p,title:f||d.name,description:g||""});if(q)throw Error(`Failed to save media record: ${q.message||JSON.stringify(q)}`)}async function v(a){let{data:{user:c}}=await b.auth.getUser();if(!c)throw Error("User not authenticated");let{data:d,error:e}=await b.from("media").select("url").eq("id",a).single();if(e||!d)throw Error("Media not found");let f=new URL(d.url).pathname.split("/storage/v1/object/public/trip-media/")[1],{error:g}=await b.storage.from("trip-media").remove([f]),{error:h}=await b.from("media").delete().eq("id",a);if(h)throw Error(`Failed to delete media: ${h.message}`)}async function w(a,c){let{data:d,error:e}=await b.from("trip_days").select("id").eq("trip_id",a).eq("day_index",c).single();if(e||!d)return[];let{data:f,error:g}=await b.from("media").select("*").eq("trip_day_id",d.id).order("created_at",{ascending:!1});return g?[]:f||[]}async function x(a,c){let{data:{user:d}}=await b.auth.getUser();if(!d)throw Error("User not authenticated");let e={};void 0!==c.title&&(e.title=c.title),void 0!==c.description&&(e.description=c.description),void 0!==c.budget&&(e.budget=c.budget),void 0!==c.currency&&(e.currency=c.currency),void 0!==c.start_date&&(e.start_date=c.start_date),void 0!==c.end_date&&(e.end_date=c.end_date);let{error:f}=await b.from("trips").update(e).eq("id",a).eq("user_id",d.id);if(f)throw Error(`Failed to update trip: ${f.message}`)}async function y(a){let{data:{user:c}}=await b.auth.getUser();if(!c)throw Error("User not authenticated");let{error:d}=await b.from("expenses").delete().eq("id",a);if(d)throw Error(`Failed to delete expense: ${d.message}`)}async function z(a,c){let{data:{user:d}}=await b.auth.getUser();if(!d)throw Error("User not authenticated");let e=c.name.split(".").pop(),f=`${a}/cover-${Date.now()}.${e}`,g=`trip-covers/${f}`,{error:h}=await b.storage.from("trip-media").upload(g,c,{upsert:!0});if(h)throw Error(`Failed to upload cover image: ${h.message}`);let{data:i}=b.storage.from("trip-media").getPublicUrl(g),j=i.publicUrl,{error:k}=await b.from("trips").update({cover_image:j}).eq("id",a);if(k)throw Error(`Failed to save cover image: ${k.message}`);return j}a.s(["addActivity",()=>n,"addExpense",()=>t,"addPackingItem",()=>r,"createTrip",()=>i,"deleteActivity",()=>p,"deleteExpense",()=>y,"deleteMedia",()=>v,"deleteTrip",()=>q,"deleteTripDay",()=>m,"getMediaForDay",()=>w,"getTrip",()=>j,"getUserTrips",()=>k,"savePackingList",()=>s,"updateActivity",()=>o,"updateTrip",()=>x,"updateTripDay",()=>l,"uploadMedia",()=>u,"uploadTripCoverImage",()=>z])}];

//# sourceMappingURL=All%20Git%20Clones_Travel%20Planner_triptimeline_src_lib_trip-service_ts_3767527a._.js.map