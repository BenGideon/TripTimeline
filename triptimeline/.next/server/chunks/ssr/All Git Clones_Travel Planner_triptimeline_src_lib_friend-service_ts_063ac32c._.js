module.exports=[92952,a=>{"use strict";let b=(0,a.i(14523).createClient)();async function c(){let{data:{user:a}}=await b.auth.getUser();if(!a)return null;let{data:c,error:d}=await b.from("user_profiles").select("*").eq("id",a.id).single();return d?null:c}async function d(a){let{data:{user:c}}=await b.auth.getUser();if(!c)throw Error("User not authenticated");let{error:d}=await b.from("user_profiles").update(a).eq("id",c.id);if(d)throw Error(`Failed to update profile: ${d.message}`)}async function e(a){let{data:{user:c}}=await b.auth.getUser();if(!c)return[];let{data:d,error:e}=await b.from("user_profiles").select("*").or(`full_name.ilike.%${a}%,email.ilike.%${a}%,username.ilike.%${a}%`).neq("id",c.id).limit(10);return e?[]:d||[]}async function f(a){let{data:{user:c}}=await b.auth.getUser();if(!c)throw Error("User not authenticated");let{error:d}=await b.from("friends").insert({user_id:c.id,friend_id:a,status:"pending"});if(d){if("23505"===d.code||d.message?.includes("friends_user_id_friend_id_key")){let a=Error("FRIEND_REQUEST_ALREADY_EXISTS");throw a.code="FRIEND_REQUEST_ALREADY_EXISTS",a}throw Error(`Failed to send friend request: ${d.message}`)}}async function g(a){let{data:{user:c}}=await b.auth.getUser();if(!c)throw Error("User not authenticated");let{error:d}=await b.from("friends").update({status:"accepted"}).eq("id",a).eq("friend_id",c.id);if(d)throw Error(`Failed to accept friend request: ${d.message}`);let{data:e}=await b.from("friends").select("user_id, friend_id").eq("id",a).single();if(e){let{error:a}=await b.from("friends").insert({user_id:c.id,friend_id:e.user_id,status:"accepted"});a&&a.message.includes("duplicate")}}async function h(a){let{data:{user:c}}=await b.auth.getUser();if(!c)throw Error("User not authenticated");let{error:d}=await b.from("friends").delete().eq("id",a).eq("friend_id",c.id);if(d)throw Error(`Failed to decline friend request: ${d.message}`)}async function i(a){let{data:{user:c}}=await b.auth.getUser();if(!c)throw Error("User not authenticated");let{error:d}=await b.from("friends").delete().eq("user_id",c.id).eq("friend_id",a),{error:e}=await b.from("friends").delete().eq("user_id",a).eq("friend_id",c.id);if(d||e)throw Error("Failed to remove friend")}async function j(){let{data:{user:a}}=await b.auth.getUser();if(!a)return[];try{let{data:c,error:d}=await b.from("friends").select(`
        *,
        friend_profile:user_profiles!friends_friend_id_fkey(*)
      `).eq("user_id",a.id).eq("status","accepted");if(d)return d.message?.includes('relation "public.friends" does not exist')||d.message?.includes('relation "public.user_profiles" does not exist'),[];return c||[]}catch(a){return[]}}async function k(){let{data:{user:a}}=await b.auth.getUser();if(!a)return[];try{let{data:c,error:d}=await b.from("friends").select(`
        id,
        status,
        created_at,
        from_user:user_profiles!friends_user_id_fkey(*),
        to_user:user_profiles!friends_friend_id_fkey(*)
      `).eq("friend_id",a.id).eq("status","pending");if(d){if(d.message?.includes('relation "public.friends" does not exist'))throw Error("FRIENDS_TABLE_MISSING");return[]}return c||[]}catch(a){if("FRIENDS_TABLE_MISSING"===a.message)throw a;return[]}}async function l(a,c,d="viewer"){let{data:{user:e}}=await b.auth.getUser();if(!e)throw Error("User not authenticated");let{error:f}=await b.from("trip_collaborators").insert({trip_id:a,user_id:c,role:d,invited_by:e.id,status:"pending"});if(f){if("23505"===f.code||f.message?.includes("trip_collaborators_trip_id_user_id_key")){let a=Error("TRIP_COLLABORATOR_ALREADY_INVITED");throw a.code="TRIP_COLLABORATOR_ALREADY_INVITED",a}throw Error(`Failed to invite user to trip: ${f.message}`)}}async function m(a){let{data:{user:c}}=await b.auth.getUser();if(!c)throw Error("User not authenticated");let{data:d,error:e}=await b.from("trip_collaborators").update({status:"accepted"}).eq("id",a).eq("user_id",c.id);if(e)throw Error(`Failed to accept trip invitation: ${e.message}`)}async function n(a){let{data:{user:c}}=await b.auth.getUser();if(!c)throw Error("User not authenticated");let{error:d}=await b.from("trip_collaborators").update({status:"declined"}).eq("id",a).eq("user_id",c.id);if(d)throw Error(`Failed to decline trip invitation: ${d.message}`)}async function o(a,c){let{data:{user:d}}=await b.auth.getUser();if(!d)throw Error("User not authenticated");let{error:e}=await b.from("trip_collaborators").delete().eq("trip_id",a).eq("user_id",c);if(e)throw Error(`Failed to remove user from trip: ${e.message}`)}async function p(a){let{data:c,error:d}=await b.from("trip_collaborators").select(`
      *,
      user_profile:user_profiles!trip_collaborators_user_id_fkey(*),
      inviter_profile:user_profiles!trip_collaborators_invited_by_fkey(*)
    `).eq("trip_id",a).eq("status","accepted");return d?[]:c||[]}async function q(){let{data:{user:a}}=await b.auth.getUser();if(!a)return[];try{let{data:c,error:d}=await b.from("trip_collaborators").select(`
        id,
        role,
        status,
        created_at,
        trip:trips(id, title, destination, start_date, end_date)
      `).eq("user_id",a.id).eq("status","pending");if(d){if(d.message?.includes('relation "public.trip_collaborators" does not exist')||d.message?.includes('relation "public.user_profiles" does not exist'))throw Error("FRIENDS_TABLE_MISSING");return[]}return c||[]}catch(a){if("FRIENDS_TABLE_MISSING"===a.message)throw a;return[]}}async function r(a,c,d){let{data:{user:e}}=await b.auth.getUser();if(!e)throw Error("User not authenticated");let{error:f}=await b.from("trip_collaborators").update({role:d}).eq("trip_id",a).eq("user_id",c);if(f)throw Error(`Failed to update collaborator role: ${f.message}`)}async function s(a){let{data:{user:c}}=await b.auth.getUser();if(!c)return!1;let{data:d}=await b.from("trips").select("user_id").eq("id",a).single();if(d&&d.user_id===c.id)return!0;let{data:e}=await b.from("trip_collaborators").select("role").eq("trip_id",a).eq("user_id",c.id).eq("status","accepted").single();return e&&("editor"===e.role||"owner"===e.role)}a.s(["acceptFriendRequest",()=>g,"acceptTripInvitation",()=>m,"canEditTrip",()=>s,"declineFriendRequest",()=>h,"declineTripInvitation",()=>n,"getCurrentUserProfile",()=>c,"getFriendRequests",()=>k,"getFriends",()=>j,"getTripCollaborators",()=>p,"getTripInvitations",()=>q,"inviteToTrip",()=>l,"removeFriend",()=>i,"removeFromTrip",()=>o,"searchUsers",()=>e,"sendFriendRequest",()=>f,"updateCollaboratorRole",()=>r,"updateUserProfile",()=>d])}];

//# sourceMappingURL=All%20Git%20Clones_Travel%20Planner_triptimeline_src_lib_friend-service_ts_063ac32c._.js.map