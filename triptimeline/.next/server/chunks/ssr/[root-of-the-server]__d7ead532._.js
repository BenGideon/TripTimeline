module.exports=[56704,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},20635,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},32319,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},65277,(a,b,c)=>{"use strict";b.exports=a.r(15552).vendored.contexts.AppRouterContext},53262,(a,b,c)=>{"use strict";b.exports=a.r(15552).vendored.contexts.HooksClientContext},15641,(a,b,c)=>{"use strict";b.exports=a.r(15552).vendored.contexts.ServerInsertedHtml},92952,a=>{"use strict";let b=(0,a.i(14523).createClient)();async function c(){let{data:{user:a}}=await b.auth.getUser();if(!a)return null;let{data:c,error:d}=await b.from("user_profiles").select("*").eq("id",a.id).single();return d?null:c}async function d(a){let{data:{user:c}}=await b.auth.getUser();if(!c)throw Error("User not authenticated");let{error:d}=await b.from("user_profiles").update(a).eq("id",c.id);if(d)throw Error(`Failed to update profile: ${d.message}`)}async function e(a){let{data:{user:c}}=await b.auth.getUser();if(!c)return[];let{data:d,error:e}=await b.from("user_profiles").select("*").or(`full_name.ilike.%${a}%,email.ilike.%${a}%,username.ilike.%${a}%`).neq("id",c.id).limit(10);return e?[]:d||[]}async function f(a){let{data:{user:c}}=await b.auth.getUser();if(!c)throw Error("User not authenticated");let{error:d}=await b.from("friends").insert({user_id:c.id,friend_id:a,status:"pending"});if(d){if("23505"===d.code||d.message?.includes("friends_user_id_friend_id_key")){let a=Error("FRIEND_REQUEST_ALREADY_EXISTS");throw a.code="FRIEND_REQUEST_ALREADY_EXISTS",a}throw Error(`Failed to send friend request: ${d.message}`)}}async function g(a){let{data:{user:c}}=await b.auth.getUser();if(!c)throw Error("User not authenticated");let{error:d}=await b.from("friends").update({status:"accepted"}).eq("id",a).eq("friend_id",c.id);if(d)throw Error(`Failed to accept friend request: ${d.message}`);let{data:e}=await b.from("friends").select("user_id, friend_id").eq("id",a).single();if(e){let{error:a}=await b.from("friends").insert({user_id:c.id,friend_id:e.user_id,status:"accepted"});a&&a.message.includes("duplicate")}}async function h(a){let{data:{user:c}}=await b.auth.getUser();if(!c)throw Error("User not authenticated");let{error:d}=await b.from("friends").delete().eq("id",a).eq("friend_id",c.id);if(d)throw Error(`Failed to decline friend request: ${d.message}`)}async function i(a){let{data:{user:c}}=await b.auth.getUser();if(!c)throw Error("User not authenticated");let{error:d}=await b.from("friends").delete().eq("user_id",c.id).eq("friend_id",a),{error:e}=await b.from("friends").delete().eq("user_id",a).eq("friend_id",c.id);if(d||e)throw Error("Failed to remove friend")}async function j(){let{data:{user:a}}=await b.auth.getUser();if(!a)return[];try{let{data:c,error:d}=await b.from("friends").select(`
        *,
        friend_profile:user_profiles!friends_friend_id_fkey(*)
      `).eq("user_id",a.id).eq("status","accepted");if(d)return d.message?.includes('relation "public.friends" does not exist')||d.message?.includes('relation "public.user_profiles" does not exist'),[];return c||[]}catch(a){return[]}}async function k(){let{data:{user:a}}=await b.auth.getUser();if(!a)return[];try{let{data:c,error:d}=await b.from("friends").select(`
        id,
        status,
        created_at,
        from_user:user_profiles!friends_user_id_fkey(*),
        to_user:user_profiles!friends_friend_id_fkey(*)
      `).eq("friend_id",a.id).eq("status","pending");if(d){if(d.message?.includes('relation "public.friends" does not exist'))throw Error("FRIENDS_TABLE_MISSING");return[]}return c||[]}catch(a){if("FRIENDS_TABLE_MISSING"===a.message)throw a;return[]}}async function l(a,c,d="viewer"){let{data:{user:e}}=await b.auth.getUser();if(!e)throw Error("User not authenticated");let{error:f}=await b.from("trip_collaborators").insert({trip_id:a,user_id:c,role:d,invited_by:e.id,status:"pending"});if(f){if("23505"===f.code||f.message?.includes("trip_collaborators_trip_id_user_id_key")){let a=Error("TRIP_COLLABORATOR_ALREADY_INVITED");throw a.code="TRIP_COLLABORATOR_ALREADY_INVITED",a}throw Error(`Failed to invite user to trip: ${f.message}`)}}async function m(a){let{data:{user:c}}=await b.auth.getUser();if(!c)throw Error("User not authenticated");let{data:d,error:e}=await b.from("trip_collaborators").update({status:"accepted"}).eq("id",a).eq("user_id",c.id);if(e)throw Error(`Failed to accept trip invitation: ${e.message}`)}async function n(a){let{data:{user:c}}=await b.auth.getUser();if(!c)throw Error("User not authenticated");let{error:d}=await b.from("trip_collaborators").update({status:"declined"}).eq("id",a).eq("user_id",c.id);if(d)throw Error(`Failed to decline trip invitation: ${d.message}`)}async function o(a,c){let{data:{user:d}}=await b.auth.getUser();if(!d)throw Error("User not authenticated");let{error:e}=await b.from("trip_collaborators").delete().eq("trip_id",a).eq("user_id",c);if(e)throw Error(`Failed to remove user from trip: ${e.message}`)}async function p(a){let{data:c,error:d}=await b.from("trip_collaborators").select(`
      *,
      user_profile:user_profiles!trip_collaborators_user_id_fkey(*),
      inviter_profile:user_profiles!trip_collaborators_invited_by_fkey(*)
    `).eq("trip_id",a).eq("status","accepted");return d?[]:c||[]}async function q(){let{data:{user:a}}=await b.auth.getUser();if(!a)return[];try{let{data:c,error:d}=await b.from("trip_collaborators").select(`
        id,
        role,
        status,
        created_at,
        trip:trips(id, title, destination, start_date, end_date)
      `).eq("user_id",a.id).eq("status","pending");if(d){if(d.message?.includes('relation "public.trip_collaborators" does not exist')||d.message?.includes('relation "public.user_profiles" does not exist'))throw Error("FRIENDS_TABLE_MISSING");return[]}return c||[]}catch(a){if("FRIENDS_TABLE_MISSING"===a.message)throw a;return[]}}async function r(a,c,d){let{data:{user:e}}=await b.auth.getUser();if(!e)throw Error("User not authenticated");let{error:f}=await b.from("trip_collaborators").update({role:d}).eq("trip_id",a).eq("user_id",c);if(f)throw Error(`Failed to update collaborator role: ${f.message}`)}async function s(a){let{data:{user:c}}=await b.auth.getUser();if(!c)return!1;let{data:d}=await b.from("trips").select("user_id").eq("id",a).single();if(d&&d.user_id===c.id)return!0;let{data:e}=await b.from("trip_collaborators").select("role").eq("trip_id",a).eq("user_id",c.id).eq("status","accepted").single();return e&&("editor"===e.role||"owner"===e.role)}a.s(["acceptFriendRequest",()=>g,"acceptTripInvitation",()=>m,"canEditTrip",()=>s,"declineFriendRequest",()=>h,"declineTripInvitation",()=>n,"getCurrentUserProfile",()=>c,"getFriendRequests",()=>k,"getFriends",()=>j,"getTripCollaborators",()=>p,"getTripInvitations",()=>q,"inviteToTrip",()=>l,"removeFriend",()=>i,"removeFromTrip",()=>o,"searchUsers",()=>e,"sendFriendRequest",()=>f,"updateCollaboratorRole",()=>r,"updateUserProfile",()=>d])},46975,a=>{"use strict";var b=a.i(32360),c=a.i(21805),d=a.i(43505),e=a.i(13801),f=a.i(92952);function g(){let{user:a,loading:g}=(0,d.useAuth)(),h=(0,e.useRouter)(),[i,j]=(0,c.useState)([]),[k,l]=(0,c.useState)([]),[m,n]=(0,c.useState)([]),[o,p]=(0,c.useState)(""),[q,r]=(0,c.useState)("friends"),[s,t]=(0,c.useState)(!0);(0,c.useEffect)(()=>{g||a||h.push("/auth/login")},[a,g,h]),(0,c.useEffect)(()=>{a&&u()},[a]);let u=async()=>{try{let[a,b]=await Promise.all([(0,f.getFriends)(),(0,f.getFriendRequests)()]);j(a),l(b)}catch(a){console.error("Error loading friends data:",a)}finally{t(!1)}},v=async a=>{if(p(a),a.trim().length>2)try{let b=await (0,f.searchUsers)(a);n(b)}catch(a){console.error("Error searching users:",a)}else n([])},w=async a=>{try{await (0,f.sendFriendRequest)(a),n(m.filter(b=>b.id!==a)),alert("Friend request sent!")}catch(a){console.error("Error sending friend request:",a),a?.code==="FRIEND_REQUEST_ALREADY_EXISTS"?alert("Friend request already sent. Wait for them to respond."):alert("Failed to send friend request")}},x=async a=>{try{await (0,f.acceptFriendRequest)(a),await u()}catch(a){console.error("Error accepting friend request:",a),alert("Failed to accept friend request")}},y=async a=>{try{await (0,f.declineFriendRequest)(a),l(k.filter(b=>b.id!==a))}catch(a){console.error("Error declining friend request:",a),alert("Failed to decline friend request")}},z=async a=>{if(window.confirm("Are you sure you want to remove this friend?"))try{await (0,f.removeFriend)(a),j(i.filter(b=>b.friend_id!==a))}catch(a){console.error("Error removing friend:",a),alert("Failed to remove friend")}};return g||s?(0,b.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 via-blue-50 to-indigo-100 flex items-center justify-center",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto mb-4"}),(0,b.jsx)("p",{className:"text-gray-600",children:"Loading friends..."})]})}):(0,b.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 via-blue-50 to-indigo-100",children:[(0,b.jsx)("div",{className:"bg-white/80 backdrop-blur-sm border-b border-white/20 sticky top-0 z-10",children:(0,b.jsx)("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,b.jsx)("div",{className:"flex items-center justify-between h-16",children:(0,b.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,b.jsx)("button",{onClick:()=>h.push("/dashboard"),className:"text-gray-600 hover:text-gray-900 transition-colors",children:"â† Back to Dashboard"}),(0,b.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Friends"})]})})})}),(0,b.jsxs)("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,b.jsxs)("div",{className:"flex space-x-1 bg-white/60 backdrop-blur-sm rounded-xl p-1 mb-8",children:[(0,b.jsxs)("button",{onClick:()=>r("friends"),className:`flex-1 py-2 px-4 rounded-lg font-medium transition-all ${"friends"===q?"bg-white text-purple-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:["Friends (",i.length,")"]}),(0,b.jsxs)("button",{onClick:()=>r("requests"),className:`flex-1 py-2 px-4 rounded-lg font-medium transition-all ${"requests"===q?"bg-white text-purple-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:["Requests (",k.length,")"]}),(0,b.jsx)("button",{onClick:()=>r("search"),className:`flex-1 py-2 px-4 rounded-lg font-medium transition-all ${"search"===q?"bg-white text-purple-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:"Add Friends"})]}),"friends"===q&&(0,b.jsx)("div",{className:"space-y-4",children:0===i.length?(0,b.jsxs)("div",{className:"text-center py-12 bg-white/60 backdrop-blur-sm rounded-2xl",children:[(0,b.jsx)("div",{className:"w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,b.jsx)("svg",{className:"w-8 h-8 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"})})}),(0,b.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No friends yet"}),(0,b.jsx)("p",{className:"text-gray-600 mb-4",children:"Start building your travel network!"}),(0,b.jsx)("button",{onClick:()=>r("search"),className:"bg-gradient-to-r from-purple-600 to-blue-600 text-white px-6 py-2 rounded-lg font-medium hover:from-purple-700 hover:to-blue-700 transition-all",children:"Add Friends"})]}):(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:i.map(a=>(0,b.jsx)("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-6 shadow-sm border border-white/20",children:(0,b.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,b.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-purple-400 to-blue-400 rounded-full flex items-center justify-center",children:(0,b.jsx)("span",{className:"text-white font-semibold text-lg",children:a.friend_profile?.full_name?.charAt(0)||a.friend_profile?.email?.charAt(0)||"?"})}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("h3",{className:"font-semibold text-gray-900",children:a.friend_profile?.full_name||"Unknown User"}),(0,b.jsx)("p",{className:"text-sm text-gray-600",children:a.friend_profile?.email})]}),(0,b.jsx)("button",{onClick:()=>z(a.friend_id),className:"text-red-500 hover:text-red-700 p-2 rounded-lg hover:bg-red-50 transition-colors",title:"Remove friend",children:(0,b.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})},a.id))})}),"requests"===q&&(0,b.jsx)("div",{className:"space-y-4",children:0===k.length?(0,b.jsxs)("div",{className:"text-center py-12 bg-white/60 backdrop-blur-sm rounded-2xl",children:[(0,b.jsx)("div",{className:"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,b.jsx)("svg",{className:"w-8 h-8 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"})})}),(0,b.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No pending requests"}),(0,b.jsx)("p",{className:"text-gray-600",children:"You're all caught up!"})]}):(0,b.jsx)("div",{className:"space-y-4",children:k.map(a=>(0,b.jsx)("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-6 shadow-sm border border-white/20",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,b.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-green-400 to-blue-400 rounded-full flex items-center justify-center",children:(0,b.jsx)("span",{className:"text-white font-semibold text-lg",children:a.from_user.full_name?.charAt(0)||a.from_user.email?.charAt(0)||"?"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-semibold text-gray-900",children:a.from_user.full_name||"Unknown User"}),(0,b.jsx)("p",{className:"text-sm text-gray-600",children:a.from_user.email}),(0,b.jsxs)("p",{className:"text-xs text-gray-500",children:["Sent ",new Date(a.created_at).toLocaleDateString()]})]})]}),(0,b.jsxs)("div",{className:"flex space-x-2",children:[(0,b.jsx)("button",{onClick:()=>x(a.id),className:"bg-green-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-green-700 transition-colors",children:"Accept"}),(0,b.jsx)("button",{onClick:()=>y(a.id),className:"bg-gray-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-gray-700 transition-colors",children:"Decline"})]})]})},a.id))})}),"search"===q&&(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-6 shadow-sm border border-white/20",children:(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("input",{type:"text",placeholder:"Search by name, email, or username...",value:o,onChange:a=>v(a.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"}),(0,b.jsx)("svg",{className:"absolute left-3 top-3.5 h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})]})}),m.length>0&&(0,b.jsx)("div",{className:"space-y-4",children:m.map(a=>(0,b.jsx)("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-6 shadow-sm border border-white/20",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,b.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-purple-400 to-pink-400 rounded-full flex items-center justify-center",children:(0,b.jsx)("span",{className:"text-white font-semibold text-lg",children:a.full_name?.charAt(0)||a.email?.charAt(0)||"?"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-semibold text-gray-900",children:a.full_name||"Unknown User"}),(0,b.jsx)("p",{className:"text-sm text-gray-600",children:a.email}),a.username&&(0,b.jsxs)("p",{className:"text-xs text-gray-500",children:["@",a.username]})]})]}),(0,b.jsx)("button",{onClick:()=>w(a.id),className:"bg-gradient-to-r from-purple-600 to-blue-600 text-white px-4 py-2 rounded-lg font-medium hover:from-purple-700 hover:to-blue-700 transition-all",children:"Add Friend"})]})},a.id))}),o.length>2&&0===m.length&&(0,b.jsx)("div",{className:"text-center py-8 bg-white/60 backdrop-blur-sm rounded-xl",children:(0,b.jsxs)("p",{className:"text-gray-600",children:['No users found matching "',o,'"']})})]})]})]})}a.s(["default",()=>g])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__d7ead532._.js.map