ADD THESE FUNCTIONS TO src/lib/trip-service.ts AT THE END (after line 567):

---

export async function uploadMedia(
  tripId: string,
  dayIndex: number,
  file: File,
  mediaType: 'image' | 'video',
  title?: string,
  description?: string
): Promise<void> {
  const { data: { user } } = await supabase.auth.getUser();
  if (!user) throw new Error('User not authenticated');

  // Find the trip day
  const { data: tripDay, error: findError } = await (supabase as any)
    .from('trip_days')
    .select('id')
    .eq('trip_id', tripId)
    .eq('day_index', dayIndex)
    .single();

  if (findError || !tripDay) {
    throw new Error('Trip day not found');
  }

  // Upload file to Supabase Storage
  const fileExt = file.name.split('.').pop();
  const fileName = `${tripId}/${tripDay.id}/${Date.now()}.${fileExt}`;
  const storagePath = `media/${fileName}`;

  const { error: uploadError } = await supabase.storage
    .from('trip-media')
    .upload(storagePath, file, { upsert: false });

  if (uploadError) {
    throw new Error(`Failed to upload file: ${uploadError.message}`);
  }

  // Get public URL
  const { data } = supabase.storage
    .from('trip-media')
    .getPublicUrl(storagePath);

  const mediaUrl = data.publicUrl;

  // Save media record to database
  const { error: dbError } = await (supabase as any)
    .from('media')
    .insert({
      trip_day_id: tripDay.id,
      type: mediaType,
      url: mediaUrl,
      title: title || file.name,
      description: description || ''
    });

  if (dbError) {
    throw new Error(`Failed to save media record: ${dbError.message}`);
  }

  console.log('Media uploaded successfully');
}

export async function deleteMedia(mediaId: string): Promise<void> {
  const { data: { user } } = await supabase.auth.getUser();
  if (!user) throw new Error('User not authenticated');

  // Get media record to find file path
  const { data: media, error: fetchError } = await (supabase as any)
    .from('media')
    .select('url')
    .eq('id', mediaId)
    .single();

  if (fetchError || !media) {
    throw new Error('Media not found');
  }

  // Extract file path from URL
  const url = new URL(media.url);
  const filePath = url.pathname.split('/storage/v1/object/public/trip-media/')[1];

  // Delete from storage
  const { error: storageError } = await supabase.storage
    .from('trip-media')
    .remove([filePath]);

  if (storageError) {
    console.warn('Failed to delete file from storage:', storageError);
  }

  // Delete from database
  const { error: dbError } = await (supabase as any)
    .from('media')
    .delete()
    .eq('id', mediaId);

  if (dbError) {
    throw new Error(`Failed to delete media: ${dbError.message}`);
  }

  console.log('Media deleted successfully');
}

export async function getMediaForDay(tripId: string, dayIndex: number): Promise<any[]> {
  const { data: tripDay, error: findError } = await (supabase as any)
    .from('trip_days')
    .select('id')
    .eq('trip_id', tripId)
    .eq('day_index', dayIndex)
    .single();

  if (findError || !tripDay) {
    return [];
  }

  const { data: media, error } = await (supabase as any)
    .from('media')
    .select('*')
    .eq('trip_day_id', tripDay.id)
    .order('created_at', { ascending: false });

  if (error) {
    console.error('Error fetching media:', error);
    return [];
  }

  return media || [];
}
